<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>키워드 분석 보고서 생성기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f2f5 0%, #e8eaf6 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #6c63ff 0%, #4834d4 100%);
            padding: 40px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .form-container {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #6c63ff;
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
        }

        .form-group textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: #6c63ff;
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
        }

        .help-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
            line-height: 1.5;
        }

        .sample-data {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #495057;
            border-left: 4px solid #6c63ff;
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #6c63ff 0%, #4834d4 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(108, 99, 255, 0.25);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .preview-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .preview-table th,
        .preview-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .preview-table th {
            background: #6c63ff;
            color: white;
            font-weight: 600;
        }

        .stats-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-item .number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #6c63ff;
        }

        .stat-item .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .result-section {
            margin-top: 30px;
            padding: 20px;
            background: #e8f5e8;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .result-section h3 {
            color: #28a745;
            margin-bottom: 10px;
        }

        .file-link {
            color: #6c63ff;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .file-link:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .form-container {
                padding: 20px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head><body>
    <div class="container">
        <div class="header">
            <h1>키워드 분석 보고서 생성기</h1>
            <p>고객사 정보와 키워드 데이터를 입력하여 전문 보고서를 생성하세요</p>
        </div>

        <div class="form-container">
            <form id="reportForm">
                <div class="form-group">
                    <label for="clientName">고객사명 *</label>
                    <input type="text" id="clientName" name="clientName" required placeholder="예: 제주도관광공사">
                    <div class="help-text">보고서에 표시될 고객사명을 입력하세요</div>
                </div>

                <div class="form-group">
                    <label for="reportDate">날짜</label>
                    <input type="date" id="reportDate" name="reportDate">
                    <div class="help-text">미입력시 오늘 날짜로 자동 설정됩니다</div>
                </div>

                <div class="form-group">
                    <label for="keywordData">키워드 데이터 *</label>
                    <textarea id="keywordData" name="keywordData" required 
                              placeholder="키워드와 검색량을 탭 또는 공백으로 구분하여 입력하세요"></textarea>
                    <div class="help-text">
                        한 줄에 하나씩 입력하세요. 키워드와 검색량을 탭이나 공백으로 구분<br>
                        예시: 제주도맛집 61100<br>
                        콤마(,)가 포함된 숫자도 자동으로 처리됩니다
                    </div>
                    <div class="sample-data">
제주도맛집	61,100
제주가볼만한곳	60,250
제주도가볼만한곳	49,000
제주맛집	47,610
함덕맛집	31,970</div>
                </div>

                <button type="button" class="generate-btn" onclick="previewData()">데이터 미리보기</button>
                <button type="submit" class="generate-btn" id="generateBtn" disabled>보고서 생성하기</button>
            </form>

            <div id="previewSection" class="preview-section" style="display: none;">
                <h3>데이터 미리보기</h3>
                <div id="statsPreview" class="stats-preview"></div>
                <table id="previewTable" class="preview-table">
                    <thead>
                        <tr>
                            <th>순위</th>
                            <th>키워드</th>
                            <th>월간 검색량</th>
                        </tr>
                    </thead>
                    <tbody id="previewBody"></tbody>
                </table>
            </div>

            <div id="resultSection" class="result-section" style="display: none;">
                <h3>보고서 생성 완료!</h3>
                <p>생성된 보고서가 다운로드 되었습니다.</p>
                <p>파일명: <span id="fileName"></span></p>
                <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                    다운로드된 HTML 파일을 웹 서버에 업로드하여 고객에게 링크를 전달하세요.
                </p>
            </div>
        </div>
    </div>

    <script>
        let parsedKeywords = [];

        // 오늘 날짜를 기본값으로 설정
        document.getElementById('reportDate').valueAsDate = new Date();

        function parseKeywordData(rawData) {
            const lines = rawData.trim().split('\n').filter(line => line.trim());
            const keywords = [];
            
            for (let line of lines) {
                // 탭, 공백, 여러 공백으로 분리 시도
                let parts = line.trim().split(/\t+|\s{2,}|\s+/);
                
                if (parts.length >= 2) {
                    const keyword = parts[0].trim();
                    const volumeStr = parts[parts.length - 1].trim();
                    
                    // 숫자에서 콤마 제거 후 파싱
                    const volume = parseInt(volumeStr.replace(/,/g, ''));
                    
                    if (keyword && !isNaN(volume)) {
                        keywords.push({ keyword, volume });
                    }
                }
            }
            
            // 검색량 기준으로 내림차순 정렬
            return keywords.sort((a, b) => b.volume - a.volume);
        }

        function calculateStats(keywords) {
            if (keywords.length === 0) return {};
            
            const totalKeywords = keywords.length;
            const totalVolume = keywords.reduce((sum, k) => sum + k.volume, 0);
            const avgVolume = Math.round(totalVolume / totalKeywords);
            const maxVolume = Math.max(...keywords.map(k => k.volume));
            
            return { totalKeywords, totalVolume, avgVolume, maxVolume };
        }

        function previewData() {
            const rawData = document.getElementById('keywordData').value;
            
            if (!rawData.trim()) {
                alert('키워드 데이터를 입력해주세요.');
                return;
            }
            
            parsedKeywords = parseKeywordData(rawData);
            
            if (parsedKeywords.length === 0) {
                alert('올바른 키워드 데이터 형식이 아닙니다.\\n키워드와 검색량을 탭 또는 공백으로 구분해주세요.');
                return;
            }
            
            // 통계 미리보기
            const stats = calculateStats(parsedKeywords);
            const statsHtml = `
                <div class="stat-item">
                    <div class="number">${stats.totalKeywords.toLocaleString()}</div>
                    <div class="label">총 키워드 수</div>
                </div>
                <div class="stat-item">
                    <div class="number">${stats.totalVolume.toLocaleString()}</div>
                    <div class="label">총 검색량</div>
                </div>
                <div class="stat-item">
                    <div class="number">${stats.avgVolume.toLocaleString()}</div>
                    <div class="label">평균 검색량</div>
                </div>
                <div class="stat-item">
                    <div class="number">${stats.maxVolume.toLocaleString()}</div>
                    <div class="label">최고 검색량</div>
                </div>
            `;
            document.getElementById('statsPreview').innerHTML = statsHtml;
            
            // 테이블 미리보기 (상위 10개만)
            const previewData = parsedKeywords.slice(0, 10);
            const tableHtml = previewData.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.keyword}</td>
                    <td>${item.volume.toLocaleString()}</td>
                </tr>
            `).join('');
            document.getElementById('previewBody').innerHTML = tableHtml;
            
            // 미리보기 섹션 표시
            document.getElementById('previewSection').style.display = 'block';
            document.getElementById('generateBtn').disabled = false;
            
            if (parsedKeywords.length > 10) {
                document.getElementById('previewSection').innerHTML += 
                    `<p style="margin-top: 10px; color: #666;">총 ${parsedKeywords.length}개 키워드 중 상위 10개만 미리보기</p>`;
            }
        }
Report Generated</h3>
                <p id="reportDate">${reportDate}</p>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="number" id="totalKeywords">${stats.totalKeywords.toLocaleString()}</div>
                <div class="label">총 키워드 수</div>
            </div>
            <div class="stat-card">
                <div class="number" id="totalVolume">${stats.totalVolume.toLocaleString()}</div>
                <div class="label">총 검색량</div>
            </div>
            <div class="stat-card">
                <div class="number" id="avgVolume">${stats.avgVolume.toLocaleString()}</div>
                <div class="label">평균 검색량</div>
            </div>
            <div class="stat-card">
                <div class="number" id="maxVolume">${stats.maxVolume.toLocaleString()}</div>
                <div class="label">최고 검색량</div>
            </div>
        </div>

        <div class="controls">
            <div class="search-box">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="searchInput" placeholder="키워드 검색..." onkeyup="filterTable()">
            </div>
            
            <div class="export-buttons">
                <button class="btn btn-primary" onclick="exportToExcel()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <span>EXCEL<br>다운로드</span>
                </button>
                <button class="btn btn-secondary" onclick="exportToPDF()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    <span>PDF<br>다운로드</span>
                </button>
            </div>
        </div>
        
        <div class="table-container">
            <table class="keyword-table" id="keywordTable">
                <thead>
                    <tr>
                        <th class="rank-cell">No.</th>
                        <th>키워드</th>
                        <th>월간 검색량</th>
                    </tr>
                </thead>
                <tbody id="keywordBody">
                    <!-- 키워드 데이터가 여기에 추가됩니다 -->
                </tbody>
            </table>
            <div class="loading" id="loadingIndicator">데이터를 불러오는 중...</div>
        </div>

        <div class="footer">
            <p class="copyright">© 2025 민컴퍼니인터내셔널(주).<br class="mobile-br">All rights reserved.</p>
            <p class="website"><a href="https://min-company.co.kr">min-company.co.kr</a></p>
            <p class="description">본 보고서는 네이버 검색 데이터를 기반으로 <br class="mobile-br">작성되었으며, 실시간 트렌드를 반영합니다.</p>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    
    <script>
        // 키워드 데이터
        const keywords = ${keywordsJson};

        // 통계 업데이트
        function updateStats() {
            const totalKeywords = keywords.length;
            const totalVolume = keywords.reduce((sum, k) => sum + k.volume, 0);
            const avgVolume = Math.round(totalVolume / totalKeywords);
            const maxVolume = Math.max(...keywords.map(k => k.volume));

            document.getElementById('totalKeywords').textContent = totalKeywords.toLocaleString();
            document.getElementById('totalVolume').textContent = totalVolume.toLocaleString();
            document.getElementById('avgVolume').textContent = avgVolume.toLocaleString();
            document.getElementById('maxVolume').textContent = maxVolume.toLocaleString();
        }

        // 테이블 렌더링
        function renderTable(data = keywords) {
            const tbody = document.getElementById('keywordBody');
            tbody.innerHTML = '';
            
            data.forEach((item, index) => {
                const row = \`
                    <tr>
                        <td class="rank-cell">\${index + 1}</td>
                        <td class="keyword-cell">\${item.keyword}</td>
                        <td class="volume-cell">\${item.volume.toLocaleString()}</td>
                    </tr>
                \`;
                tbody.innerHTML += row;
            });
        }
        
        // 검색 필터
        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = keywords.filter(k => 
                k.keyword.toLowerCase().includes(searchTerm)
            );
            renderTable(filteredData);
        }

        // Excel 내보내기
        function exportToExcel() {
            const ws_data = [
                ['순위', '키워드', '월간 검색량'],
                ...keywords.map((k, i) => [i + 1, k.keyword, k.volume])
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '키워드분석');
            
            // 컬럼 너비 설정
            ws['!cols'] = [
                {wch: 8},  // 순위
                {wch: 30}, // 키워드
                {wch: 15}  // 검색량
            ];
            
            const fileName = \`키워드분석보고서_${clientName}_${reportDate.replace(/\\./g, '')}.xlsx\`;
            XLSX.writeFile(wb, fileName);
        }
        
        // PDF 내보내기 (한글 폰트 문제 해결)
        function exportToPDF() {
            const element = document.querySelector('.container');
            
            html2canvas(element, {
                scale: 2,
                allowTaint: true,
                useCORS: true
            }).then(function(canvas) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                const fileName = \`키워드분석보고서_${clientName}_${reportDate.replace(/\\./g, '')}.pdf\`;
                doc.save(fileName);
            });
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            renderTable();
        });
    </script>
</body>
</html>\`;
        }
    </script>
</body>
</html>